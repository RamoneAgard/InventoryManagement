<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

    <form class="form" th:fragment="filterForm(categories, volumes)" id="productFilter" th:action="@{/products/table}" method="post">
        <div class="row g-3 justify-content-center">

            <div class="col-md-6 col-lg-auto">
                <div class="input-group">
                    <span class="input-group-text p-1">
                        Categories
                    </span>
                    <select class="form-select" id="filterCategory" name="category" size="3" multiple>
                        <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}">option</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6 col-lg-auto">
                <div class="input-group">
                    <span class="input-group-text p-1">
                        Unit Volumes
                    </span>
                    <select class="form-select" id="filterVolume" name="volume" size="3" multiple>
                        <option th:each="vol : ${volumes}" th:value="${vol.id}" th:text="${vol.description}">option</option>
                    </select>
                </div>
            </div>
            <div class="col col-lg-auto">
                <div class="form-floating">
                    <input class="form-control" id="filterName" type="text" name="name" placeholder="Product Name">
                    <label for="filterName">Name</label>
                </div>
            </div>
            <div class="col-3 col-lg-2">
                <div class="form-floating">
                    <input class="form-control" id="perPage" name="pageSize" type="number" placeholder="20" value="20"
                        min="1" max="50">
                    <label for="perPage"># Per Page</label>
                </div>
            </div>
            <div class="col-auto d-flex flex-column justify-content-center">
                <div class="d-flex justify-content-center mb-1"><button class="btn btn-primary" type="submit">Filter</button></div>
                <div class="d-flex justify-content-center"><button class="btn btn-warning" type="reset">Reset</button></div>
            </div>
        </div>
    </form>

    <th:block th:fragment="productTable">
        <div class="row justify-content-center px-2">
            <div class="col-md d-flex overflow-scroll rounded-4 px-0">
                <table class="table table-responsive table-striped">
                    <thead class="table-dark">
                    <tr>
                        <th>Item Code</th>
                        <th>UPC</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Volume</th>
                        <th>Cost</th>
                        <th>Price</th>
                        <th>Unit Amount</th>
                        <th>Stock</th>
                        <th>Last Modified</th>
                        <th sec:authorize="hasRole('ROLE_EDITOR')"></th>
                        <th sec:authorize="hasRole('ROLE_ADMIN')"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="prod : ${products}" class="product-row">
                        <td th:text="${prod.itemCode}">item code value</td>
                        <td th:text="${prod.upc}">upc value</td>
                        <td th:text="${prod.name}">name value</td>
                        <td th:text="${prod.category} == null? |None| : ${prod.category.name}">category name</td>
                        <td th:text="${prod.volume} == null? |None| : ${prod.volume.description}">volume description</td>
                        <td th:text="|$${prod.cost}|">cost value</td>
                        <td th:text="|$${prod.price}|">price value</td>
                        <td th:text="${prod.unitSize}">unit amount</td>
                        <td th:text="${prod.stock}">stock value</td>
                        <td th:text="${#temporals.format(prod.lastModifiedDate, 'dd-MM-yyyy, HH:mm')}">date created</td>
                        <td sec:authorize="hasRole('ROLE_EDITOR')">
                            <a class="updateBtn btn btn-outline-primary"
                               th:link="@{/products/update(id=${prod.id})}">
                                Update</a></td>
                        <td sec:authorize="hasRole('ROLE_ADMIN')">
                            <a class="deleteBtn btn btn-outline-danger" th:link="@{/products/delete(id=${prod.id},
                                                                        name=${nameQuery},
                                                                        categories=${categoriesQuery},
                                                                        volumes=${volumesQuery},
                                                                        pageNumber=${pageNumber},
                                                                        pageSize=${pageSize})}">
                                Delete</a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col">
                <nav>
                    <ul class="pagination justify-content-center">
                        <li class="page-item"
                            th:classappend="${hasPrevious} == false ? |disabled|">
                            <a class="page-link btn rounded-start rounded-end-0" id="previousPage"
                               th:link="@{/products/table(name=${nameQuery},
                            categories=${categoriesQuery},
                            volumes=${volumesQuery},
                            pageNumber=${pageNumber} - 1,
                            pageSize=${pageSize})}">
                                Previous
                            </a>
                        </li>
                        <li class="page-item"
                            th:classappend="${hasNext} == false ? |disabled|">
                            <a class="page-link btn rounded-start-0 rounded-end" id="nextPage"
                               th:link="@{/products/table(name=${nameQuery},
                            categories=${categoriesQuery},
                            volumes=${volumesQuery},
                            pageNumber=${pageNumber} + 1,
                            pageSize=${pageSize})}">
                                Next
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </th:block>
</body>
</html>